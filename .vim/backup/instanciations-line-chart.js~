Template.InstanciationsChart.onCreated(function() {
    this.chart = null;
    this.chartType = new ReactiveVar('Area');
    this.period = new ReactiveVar('day');
});

Template.InstanciationsChart.onRendered(function() {
    this.autorun(() => {
        $('#instanciations-chart').empty();

        //console.log('period: ' + this.period.get());
        //if( Template.currentData() ) {
        //    console.log('app: ' + Template.currentData().app);
        //    console.log('version: ' + Template.currentData().version);
        //    console.log('from: ' + Template.currentData().from);
        //    console.log('to: ' + Template.currentData().to);
        //}

        this.chart = new LineChart("instanciations-chart", {
            period: this.period.get(),
            type: this.chartType.get(),
            app: Template.currentData() && Template.currentData().app,
            version: Template.currentData() && Template.currentData().version,
            from: Template.currentData() && Template.currentData().from,
            to: Template.currentData() && Template.currentData().to,
        });
        this.chart.buildChart(() => {
            // force browser redraw (chrome bug?)
            $(window).resize();
            console.log('Chart displayed !');
        });
    });
});

Template.InstanciationsChart.events({
    "change .select-chart-view" : function(e, t) {
        t.period.set( $(e.target).val() );
    },

    "change .select-chart-type" : function(e, t) {
        t.chartType.set( $(e.target).val() );
    }
});
