<!-- Root App page with all the apps -->
<template name="AppsPage">
    <div class="page page-full-height bg-white">
        <h1 class="page-header">
            <button class="btn btn-lg btn-transparent link-to-dashboard" style="font-size: 24px;">
                <i class="fa fa-arrow-circle-left"></i>
            </button>
            <span>All Apps</span>
        </h1>

        <div class="card card-appgroup">
            <div class="card-header" style="line-height: 30px;">
                <span>Default group</span>

                <button class="btn btn-info btn-sm bg-blue pull-right card-new-app">
                    <i class="fa fa-plus-circle text-white"></i> &nbsp; Add new app
                </button>
            </div>
            <div class="card-body">
                <div class="col-xs-2">
                    {{#each getApps}}
                        {{> AppCard}}
                    {{/each}}
                </div>
            </div>
        </div>
    </div>
</template>

<!-- Template to display an app card, with the phases and status -->
<template name="AppCard">
    <div class="card card-app col-lg-2 m-3 d-inline-block">
        <div class="card-header">
            {{this.getName}}
        </div>
        <div class="card-body" style="text-align: center;">
            {{#if descriptionImage}}
                <img style="max-width: 100%; vertical-align: middle; max-height: 71px;" src="{{descriptionImage}}" class="all-apps-icons"/>
            {{else}}
                <img style="max-width: 100%; vertical-align: middle;" src="/img/ressources/DeployedApps_Big_Icon_success.png" class="all-apps-icons"/>
            {{/if}}
        </div>
        <div class="card-footer">
            <table>
                <tr>
                    <td class="phase">production</td>
                    <td class="version">{{{showPhase "production"}}}</td>
                </tr>
                <tr>
                    <td class="phase">beta</td>
                    <td class="version">{{{showPhase "beta"}}}</td>
                </tr>
                <tr>
                    <td class="phase">alpha</td>
                    <td class="version">{{{showPhase "alpha"}}}</td>
                </tr>
                <tr>
                    <td class="phase">dev</td>
                    <td class="version">{{{showPhase "dev"}}}</td>
                </tr>
            </table>
        </div>
    </div>
</template>

<!-- Root page of an app -->
<template name="ApplicationPage">
    <div class="page page-full-height bg-white">
        {{#if ready}}
            {{#if emptyApp}}
                {{> Template404 message="This application doesn't exist, was deleted, or you don't have access to it."}}
            {{else}}
                {{#with getApp}}
                <h1 class="page-header">
                    <button class="btn btn-lg btn-transparent btn-back link-to-apps" style="font-size: 24px;">
                        <i class="fa fa-arrow-circle-left"></i>
                    </button>
                    <span>{{name}}</span>

                    <button class="btn btn-outline-danger ml-auto pull-right btn-delete-app mr-4">Delete application</button>
                </h1>

                <div class="container-fluid">
                    <ul class="nav nav-tabs" id="app-menu" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-toggle="tab" href="#versions" role="tab" aria-controls="home" aria-selected="true">Versions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#instanciations" role="tab" aria-controls="home" aria-selected="true">Instanciations</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="versions" role="tabpanel" aria-labelledby="versions-tab">
                            <div class="row mt-4">
                                <div class="col-lg-3 col-md-3 col-xs-3">
                                    <div class="card card-app-desc">
                                        <div class="card-header">
                                            Details
                                        </div>
                                        <div class="card-body" style="padding-top: 10px; min-height: 346px; position: relative;">
                                            <div class="row">
                                                <div class="col">
                                                    <div class="app-name mb-2">
                                                        <p style="margin-bottom: 4px;">
                                                            <span class="label"><b>Name</b></span>
                                                            <button type="button" class="btn btn-transparent btn-no-focus btn-xs app-edit-name text-right" style="display: inline-block;">
                                                                <i class="fas fa-pencil-alt"></i>
                                                            </button>
                                                        </p>

                                                        <p style="font-size: 14px; margin-bottom: 0;">
                                                        {{name}}
                                                        </p>
                                                    </div>
                                                    <div class="app-title mb-2">
                                                        <p style="margin-bottom: 4px;">
                                                            <span class="label"><b>Title</b></span>
                                                            <button type="button" class="btn btn-transparent btn-no-focus btn-xs app-edit-title text-right" style="display: inline-block;">
                                                                <i class="fas fa-pencil-alt"></i>
                                                            </button>
                                                        </p>

                                                        <p style="font-size: 14px; margin-bottom: 0;">
                                                        </p>
                                                        <p class="app-title-text" style="font-size: 14px; margin-bottom: 0;">
                                                            {{#if title}}{{title}}{{else}}No title available.{{/if}}
                                                        </p>
                                                        <div class="app-title-edit" style="display: none;">
                                                            <textarea class="app-title-input form-control" rows=2 placeHolder="enter a title for {{name}}">{{title}}</textarea>
                                                            <button class="btn btn-primary mt-2 app-save-title">Save title</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <span class="label"><b>Image</b></span><br/>
                                                    {{#if descriptionImage}}
                                                        <img style="max-width: 100%;" src="{{descriptionImage}}" />
                                                    {{else}}
                                                        <img style="max-width: 100%;" src="/img/ressources/DeployedApps_Big_Icon_success.png" />
                                                    {{/if}}

                                                    <input type="file" data-appid="{{_id}}" class="app-image-upload" id="app-image-upload-input" aria-describedby="fileHelp" style="display: none;">
                                                    <button class="btn btn-secondary btn-upload-image btn-sm">Change Image</button>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <div class="app-description">
                                                        <p style="margin-bottom: 4px;">
                                                            <span class="label"><b>Description</b></span>
                                                            <button type="button" class="btn btn-transparent btn-no-focus btn-xs app-edit-description text-right" style="display: inline-block;">
                                                                <i class="fas fa-pencil-alt"></i>
                                                            </button>
                                                        </p>

                                                        <p class="app-description-text" style="font-size: 14px; margin-bottom: 0;">
                                                            {{#if description}}{{description}}{{else}}No description available.{{/if}}
                                                        </p>
                                                        <div class="app-description-edit" style="display: none;">
                                                            <textarea class="app-description-input form-control" rows=5 placeHolder="enter a description for {{name}}">{{description}}</textarea>
                                                            <button class="btn btn-primary mt-2 app-save-description">Save description</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="card card-deployments" style="display: inline-flex;">
                                        <div class="card-header">
                                            Deployments
                                        </div>
                                        <div class="card-body" style="padding-bottom: 10px;">
                                            <div class="row" style="padding-left: 15px; padding-right: 5px;">
                                                <div class="card card-phase card-phase-dev border-blue" data-phase="dev">
                                                    <div class="card-header bg-blue">
                                                        <a href="/apps/{{name}}/dev" target="_blank">dev</a>
                                                    </div>
                                                    {{#if isDeployedPhase "dev"}}
                                                        <div class="card-body">
                                                            {{#with getVersionFromPhase "dev"}}
                                                                {{> VersionCard }}
                                                            {{/with}}
                                                        </div>
                                                    {{else}}
                                                        <div class="card-body" style="width: 196px; height: 200px; line-height: 150px;"><span class="text-muted"><i class="far fa-circle"></i></span></div>
                                                    {{/if}}
                                                </div>
                                                <div class="card card-phase card-phase-alpha border-green" data-phase="alpha">
                                                    <div class="card-header bg-green">
                                                        <a href="/apps/{{name}}/alpha" target="_blank">alpha</a>
                                                    </div>
                                                    {{#if isDeployedPhase "alpha"}}
                                                        <div class="card-body">
                                                            {{#with getVersionFromPhase "alpha"}}
                                                                {{> VersionCard }}
                                                            {{/with}}
                                                        </div>
                                                    {{else}}
                                                        <div class="card-body" style="width: 196px; height: 200px; line-height: 150px;"><span class="text-muted"><i class="far fa-circle"></i></span></div>
                                                    {{/if}}
                                                </div>
                                                <div class="card card-phase card-phase-beta border-orange" data-phase="beta">
                                                    <div class="card-header bg-orange">
                                                        <a href="/apps/{{name}}/beta" target="_blank">beta</a>
                                                    </div>
                                                    {{#if isDeployedPhase "beta"}}
                                                        <div class="card-body">
                                                            {{#with getVersionFromPhase "beta"}}
                                                                {{> VersionCard }}
                                                            {{/with}}
                                                        </div>
                                                    {{else}}
                                                        <div class="card-body" style="width: 196px; height: 200px; line-height: 150px;"><span class="text-muted"><i class="far fa-circle"></i></span></div>
                                                    {{/if}}
                                                </div>
                                                <div class="card card-phase card-phase-production border-red" data-phase="production">
                                                    <div class="card-header bg-red">
                                                        <a href="/apps/{{name}}/production" target="_blank">production</a>
                                                    </div>
                                                    {{#if isDeployedPhase "production"}}
                                                        <div class="card-body">
                                                            {{#with getVersionFromPhase "production"}}
                                                                {{> VersionCard }}
                                                            {{/with}}
                                                        </div>
                                                    {{else}}
                                                        <div class="card-body" style="width: 196px; height: 200px; line-height: 150px;"><span class="text-muted"><i class="far fa-circle"></i></span></div>
                                                    {{/if}}
                                                </div>
                                            </div>
                                            <div class="row mt-2" style="text-align: center; font-size: 12px;">
                                                <span class="ml-auto mr-auto">drag &amp; drop versions to theses boxes</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card card-versions">
                                        <div class="card-header" style="line-height: 30px;">
                                            <span>Versions</span>

                                            <button class="btn btn-info btn-sm bg-blue pull-right card-new-version">
                                                <i class="fa fa-plus-circle text-white"></i> &nbsp; Add new version
                                            </button>
                                        </div>
                                        <div class="card-body d-flex justify-content-left flex-wrap">
                                            {{#each getVersions}}
                                                {{> VersionCard }}
                                            {{/each}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="instanciations" role="tabpanel" aria-labelledby="instanciations-tab">
                            <div class="mt-4">
                                {{> InstanciationsChart app=name}}
                            </div>
                        </div>
                    </div>
                </div>
                {{/with}}
            {{/if}}
        {{else}}
            {{> Loading }}
        {{/if}}
    </div>
</template>

<template name="VersionCard">
    <div class="card card-version" draggable="true" data-version="{{appVersion}}" title="{{changelog}}">
        <div class="card-header" style="position: relative;">
            {{#if title}}
                <span style="white-space: nowrap;">{{truncate title 16}}</span>
            {{else}}
                <span>No title</span>
            {{/if}}
        </div>
        <div class="card-body" style="padding-bottom: 5px;">
            <a href="/apps/{{appName}}/v/{{appVersion}}" class="link-to-version-page" draggable="false">{{appVersion}}</a>

            <div>
                <div class="dropdown deploy-dropdown">
                    <button class="btn btn-lg btn-transparent btn-deploy dropdown-toggle" id="deploy-dropdown-{{appVersion}}" title="Deploy this version" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-rocket"></i></button>
                    <div class="dropdown-menu" aria-labelledby="deploy-dropdown-{{appVersion}}">
                        <a class="dropdown-item deploy-to" data-phase="dev" data-version="{{appVersion}}" href="#">deploy to dev</a>
                        <a class="dropdown-item deploy-to" data-phase="alpha" data-version="{{appVersion}}" href="#">deploy to alpha</a>
                        <a class="dropdown-item deploy-to" data-phase="beta" data-version="{{appVersion}}" href="#">deploy to beta</a>
                        <a class="dropdown-item deploy-to" data-phase="production" data-version="{{appVersion}}" href="#">deploy to prod</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer">
            {{{getStatusHTML}}}
        </div>
    </div>
</template>

<!--
    Root page of a version
    This template works as well for a new version or for an edit
-->
<template name="VersionPage">
    <div class="page page-full-height bg-white version-page">
        {{#if ready}}
            {{#if emptyVersion}}
                <p class="mx-auto" style="margin-top: 200px; text-align: center;"></p>
                {{> Template404 message="This version doesn't exist, was deleted, or you don't have access to it."}}
            {{else}}
                {{#with getApp}}
                <h1 class="page-header">
                    <button class="btn btn-lg btn-transparent link-to-versions" style="font-size: 24px;">
                        <i class="fa fa-arrow-circle-left"></i>
                    </button>
                    <span>{{name}}</span>
                    {{#if isNewVersion}}
                        <i style="font-size: 28px;" class="fa fa-caret-right ml-2 mr-2"></i>
                        <span style="font-size: 28px;">New version</span>
                    {{else}}
                        {{#with getVersion}}
                        <i style="font-size: 28px;" class="fa fa-caret-right ml-2 mr-2"></i>
                        <span style="font-size: 28px;">{{appVersion}}</span>
                        <small style="font-size: 14px;">last updated {{getLastUpdate}} </small>
                        <div class="pull-right">
                            <button class="btn btn-outline-danger btn-delete-version">Delete version</button>
                        </div>
                        {{/with}}
                    {{/if}}
                </h1>
                {{/with}}

                <ul class="nav nav-tabs" id="app-sections" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#configuration" role="tab" aria-controls="home" aria-selected="true">Configuration</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#application" role="tab" aria-controls="home" aria-selected="true">Application</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#instanciations" role="tab" aria-controls="home" aria-selected="true">Instanciations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#installationguide" role="tab" aria-controls="home" aria-selected="true">Installation guide</a>
                    </li>

                    <div class="ml-auto">
                        <span>Status: {{#with getVersion}}{{{getStatusHTML}}}{{/with}}</span>
                    </div>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="configuration" role="tabpanel" aria-labelledby="home-tab">
                        <div class="row pb-5 mt-4">
                            <div class="col-4">
                                <div class="row">
                                    {{#if hasJSON}}
                                    <div class="col">
                                        <div class="card mb-3">
                                            <div class="card-header">Deployment</div>
                                            <div class="card-body">
                                                <p>Status: {{#with getVersion}}{{{getStatusHTML}}}{{/with}}</p>
                                                <p>Phases: {{#with getApp}}
                                                            {{#unless isNewVersion}}
                                                                {{#if isInPhases}}
                                                                    <b>{{getVersionPhases}}</b>
                                                                    <div class="alert alert-danger" role="alert">
                                                                        <p><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Please mind that if you trigger a build, <b>the application will be unavailable</b> on phases <b>{{getVersionPhases}}</b> until the deployment is finished.</p>
                                                                    </div>
                                                                {{else}}
                                                                    <b>None.</b>
                                                                {{/if}}
                                                            {{else}}
                                                                <b>None.</b>
                                                            {{/unless}}
                                                           {{/with}}
                                                </p>
                                                <div style="text-align: center;">
                                                    <div class="d-inline-block">
                                                        {{#with getVersion}}
                                                            {{#if isDeployed}}
                                                                <button class="btn btn-success btn-deploy" disabled>Build and deploy</button>
                                                            {{else}}
                                                                <button class="btn btn-success btn-deploy">Build and deploy</button>
                                                            {{/if}}
                                                        {{/with}}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {{/if}}
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="card">
                                            <div class="card-header">Version settings</div>
                                            <div class="card-body">

                                                {{#autoForm collection="AppVersions" id="version-settings-form" type=getFormType doc=getVersion}}
                                                <fieldset>
                                                    {{#with getApp}}
                                                        <!-- hidden fields -->
                                                        {{> afQuickField name='appId' value=_id}}
                                                        {{> afQuickField name='appName' value=name}}
                                                    {{/with}}

                                                    {{> afQuickField name='title' placeHolder='Name your version'}}
                                                    {{> afQuickField name='changelog' placeHolder='Explain what changed in this version'}}
                                                    {{> afQuickField name='appVersion' placeHolder='The version number, in semver format (ex: 1.6.1)'}}
                                                </fieldset>

                                                <div class="mt-3" style="text-align: center;">
                                                    <button type="submit" class="btn btn-success btn-submit btn-submit-version-settings-form mr-3" disabled>
                                                        Save
                                                    </button>
                                                </div>
                                                {{/autoForm}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col">
                                <div class="card {{isCardHidden}}">
                                    <div class="card-header">Code</div>
                                    <div class="card-body">
                                        {{#with getApp}}
                                            {{#unless isNewVersion}}
                                                {{#if isInPhases}}
                                                {{/if}}

                                                {{#with getVersion}}
                                                    {{#if isDeployError}}
                                                        {{#if buildError}}
                                                            <div class="row" style="text-align: center;">
                                                                <div class="app-version-status" style="display: inline-block;">
                                                                    <div class="build-error" style="width: 100%; margin-top: 40px;">
                                                                        <label>Last build error:</label><br/>
                                                                        <textarea rows=20 readonly style="width: 100%; min-width: 500px;">{{buildError}}</textarea>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {{/if}}
                                                    {{/if}}
                                                {{/with}}
                                            {{/unless}}
                                        {{/with}}

                                        {{#if showGraph}}
                                            <div style="text-align: center;">
                                                <div class="d-inline-block;">
                                                    <a class="btn btn-success mt-3 btn-go-to-graph" href="/apps/{{getAppName}}/v/{{getVersionName}}/graph/" target="_blank">Open in Graph Editor</a><br/>
                                                    <a class="link-to-json" href="#" style="font-size: 10px;">Or let me see the json</a>
                                                </div>
                                            </div>
                                        {{else}}
                                            <fieldset style="margin-top: 20px;">
                                                {{#autoForm collection="AppVersions" id="version-code-form" type=getFormType doc=getVersion}}
                                                {{#with getApp}}
                                                    <!-- hidden fields -->
                                                    {{> afQuickField name='appId' value=_id}}
                                                    {{> afQuickField name='appName' value=name}}
                                                {{/with}}

                                                <!-- shown fields -->
                                                <div class="col-md-12" style="padding-left: 0px;">
                                                    <div>
                                                        <label style="display: inline-block;">Json definition</label>
                                                        <select class="json-import" style="float: right;">
                                                            <option selected disabled>Import JSON from</option>
                                                            {{#each otherVersions}}
                                                            <option value="{{appVersion}}">{{appVersion}}</option>
                                                            {{/each}}
                                                        </select>
                                                    </div>
                                                    <div id="json-editor" class="mb-2"></div>
                                                </div>

                                                {{> afQuickField name='debugBuild'}}

                                                <div class="mt-3" style="text-align: center;">
                                                    <div class="d-inline-block">
                                                        <button type="submit" class="btn btn-success btn-submit mr-3">Save JSON</button><br/>
                                                    <a class="link-to-graph" href="#" style="font-size: 10px;">Or go to graph</a>
                                                    </div>
                                                </div>
                                                {{/autoForm}}
                                            </fieldset>
                                        {{/if}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="application" role="tabpanel" aria-labelledby="application-tab">
                        {{#unless isNewVersion}}
                            {{#with getApp}}
                                {{#with getVersion}}
                                    {{> ShowVersion }}
                                {{/with}}
                            {{/with}}
                        {{/unless}}
                    </div>
                    <div class="tab-pane fade" id="instanciations" role="tabpanel" aria-labelledby="instanciations-tab">
                        {{#unless isNewVersion}}
                            {{#with getApp}}
                                {{#with getVersion}}
                                    <div class="mt-4">
                                        {{> InstanciationsChart app=appName version=appVersion}}
                                    </div>
                                {{/with}}
                            {{/with}}
                        {{/unless}}
                    </div>
                    <div class="tab-pane fade" id="installationguide" role="tabpanel" aria-labelledby="installationguide-tab">
                        {{#unless isNewVersion}}
                            {{#with getApp}}
                                {{#with getVersion}}
                                    <div class="mt-4">
                                        {{> InstallationGuide app=appName version=appVersion}}
                                    </div>
                                {{/with}}
                            {{/with}}
                        {{/unless}}
                    </div>
                </div>
            {{/if}}
        {{else}}
            {{> Loading }}
        {{/if}}
    </div>
</template>

<!-- instanciate a Dualbox App version -->
<template name="ShowVersion">
    <div id="dualbox-app" style="width 100%; height: 100%;"></div>
</template>

<template name="GraphPage">
    {{> AppGraph }}
</template>

<!-- Open a Dualbox graph of an app version -->
<template name="AppGraph">
    <div class="editor" style="width: 100%; height: 100%; position: relative;"></div>

    {{#if editorLoaded }}
        {{#unless appDependenciesLoaded}}
        <div class="fullscreen">
            <div class="mx-auto" style="height: 100%; text-align: center; vertical-align: middle; position: relative;">
                <div style="position: absolute; top: 0; bottom: 0; left: 0; right: 0; margin: auto; height: 50px;">
                    <span class="text-muted">Loading application dependencies</span><br/>
                    <i class="fa fa-spinner fa-spin text-muted" style="font-size: 10px;"></i>
                </div>
            </div>
        </div>
        {{/unless}}
    {{else}}
        <div class="fullscreen">
            <div class="mx-auto" style="height: 100%; text-align: center; vertical-align: middle; position: relative;">
                <div style="position: absolute; top: 0; bottom: 0; left: 0; right: 0; margin: auto; height: 50px;">
                    <span class="text-muted">Loading editor</span><br/>
                    <i class="fa fa-spinner fa-spin text-muted" style="font-size: 10px;"></i>
                </div>
            </div>
        </div>
    {{/if}}
</template>

<!-- instanciate a Dualbox App version -->
<template name="InstallationGuide">
    <div class="container-fluid">
        <div class="row">
            <section>
                <p style="padding-left: 15Px;"><i>You can share <a href="{{rootUrl}}/installation/{{getId}}">this installation guide</a> to any developer in charge of integration your dualbox application in your website.</i></p>
            </section>
        </div>

        <div class="row">
            <main class="col mt-4">
                <section>
                    <h2 id="guide-installation">Installation of the application</h2>

                    <section>
                        <h3 id="guide-install-embedded-interface">Install with the embedded interface.</h3>
                        <p>To install the application with the embedded interface, just adapt and put the following code in the page in which you want the application to work.</p>

<blockquote class="js-code"><pre style="font-family: monospace;"><code>&lt;script&gt;
    (function(callback) {
        var s = document.createElement('script');
        s.setAttribute('src', "http://dualbox.com/loadapp.js");
        s.onload=callback; document.body.appendChild(s);
    })(function() {
        // load our app
        DualBox.load({
            "app"  : "{{getAppName}}",
            "phase": "<span style="color: red;">THE_PHASE_ON_WHICH_YOUR_VERSION_IS_DEPLOYED</span>", /* dev, alpha, beta or production */
            "loaderDiv": $('<span style="color: red;">#YOUR_DIV_TO_PUT_THE_APP_INTO</span>'),
        }, function() {
            // now instanciate it
            var app = DualBox.start({
                "logLevel": "warn",
                "profiler": false,
                "div" : $('<span style="color: red;">#YOUR_DIV_TO_PUT_THE_APP_INTO</span>')
            });

            // Trigger the start sequence specific to our app
            app.start();
        });
    });
&lt;/script&gt;</code></pre></blockquote>

                        <p>Replace "THE_PHASE_ON_WHICH_YOUR_VERSION_IS_DEPLOYED" by the current phase you want to load (see the deployements window in <a href="/apps/{{getAppName}}">the application's main page</a>), and "YOUR_DIV_TO_PUT_THE_APP_INTO" by the actual div of your web page you want to load the application to.</p>
                    </section>


                    <section>
                        <h3 id="guide-install-custom-interface">Install with your own custom interface.</h3>
                        <p>If the original embedded interface doesn't suit your needs, you can use your own interface with the Dualbox application. You can choose, in the Dualbox.start() function, which panels of the interface should be instanciated. Usually, you'll at least want the viewer panel (canvas3D and such).</p>

<blockquote class="js-code"><pre style="font-family: monospace;"><code>&lt;script&gt;
    (function(callback) {
        var s = document.createElement('script');
        s.setAttribute('src', "http://dualbox.com/loadapp.js");
        s.onload=callback; document.body.appendChild(s);
    })(function() {
        // load our app
        DualBox.load({
            "app"  : "{{getAppName}}",
            "phase": "<span style="color: red;">THE_PHASE_ON_WHICH_YOUR_VERSION_IS_DEPLOYED</span>", /* dev, alpha, beta or production */
            "loaderDiv": $('<span style="color: red;">#YOUR_DIV_TO_PUT_THE_APP_INTO</span>'),
        }, function() {
            // now instanciate it
            var app = DualBox.start({
                "logLevel": "warn",
                "profiler": false,
                "div" : $('<span style="color: red;">#YOUR_DIV_TO_PUT_THE_APP_INTO</span>'),
                "ui"  : {
                    "<span style="color: red;">PANEL_YOU_WANT</span>" : true,
                    "<span style="color: red;">OTHER_PANEL_YOU_WANT"</span>: true
                    // panel you don't want are just forgotten here
                }
            });

            // Trigger the start sequence specific to our app
            app.start();
        });
    });
&lt;/script&gt;</code></pre></blockquote>

                        <p>Replace "THE_PHASE_ON_WHICH_YOUR_VERSION_IS_DEPLOYED" by the current phase you want to load (see the deployements window in <a href="/apps/{{getAppName}}">the application's main page</a>), and "YOUR_DIV_TO_PUT_THE_APP_INTO" by the actual div of your web page you want to load the application to.</p>

                        <p>Also, replace "PANEL_YOU_WANT" and "OTHER_PANEL_YOU_WANT" with existing panel names from the application. Please find below the list of panels of the app.</p>

                        {{#with getVersion}}
                        <table class="table table-striped apps-building" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Panel name</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each getPanels}}
                                <tr>
                                    <td>{{name}}</td>
                                    <td>{{description}}</td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                        {{/with}}
                    </section>
                </section>

                <h2 id="guide-tweaking">Tweaking</h2>
                <section>
                    <h3 id="guide-tweaking-inputs">Programmatically setting inputs</h3>

                    <p>Inputs can be programmatically set directly from javascript. Its is recommanded to set all inputs before starting the app. Once you instanciated the Dualbox application into the "app" variable (like in the installation code above), you can use the following code to set an input.</p>

                    <blockquote class="js-code"><pre style="font-family: monospace;"><code>app.setInput("MY_INPUT_NAME", MY_INPUT_VALUE");</code></pre></blockquote>

                    <p>Here are the available inputs in this application:</p>

                    {{#with getVersion}}
                    <table class="table table-striped apps-building" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Input name</th>
                                <th>type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each getInputs}}
                            <tr>
                                <td>{{name}}</td>
                                <td>{{type}}</td>
                                <td>{{desc}}</td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                    {{/with}}
                </section>

                <section>
                    <h3 id="guide-tweaking-api">Use the Application API</h3>

                    <p>Some applications have APIs, available from javascript. To use an application specific API, use the trigger function.</p>

                    <blockquote class="js-code"><pre style="font-family: monospace;"><code>app.trigger("MY_API", parameters, callback);</code></pre></blockquote>

                    <p>All APIs don't need parameters or callback. Here's this application's APIs.</p>
                    {{#with getVersion}}
                    <table class="table table-striped apps-building" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>API</th>
                                <th>Description</th>
                                <th>callback</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each getEvents}}
                            <tr>
                                <td>{{name}}</td>
                                <td>{{desc}}</td>
                                <td>{{#if out}}YES{{else}}NO{{/if}}</td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                    {{/with}}
                </section>
            </main>

            <div class="col-3 mt-3">
                <ul class="section-nav sticky">
                    <li class="toc-entry toc-h2">
                        <a href="#guide-installation">Installation</a>
                        <ul>
                            <li class="toc-entry toc-h2"><a href="#guide-install-embedded-interface">Install with the embedded interface</a></li>
                            <li class="toc-entry toc-h2"><a href="#guide-install-custom-interface">Install with your own interface</a></li>
                        </ul>
                    </li>
                    <li class="toc-entry toc-h2">
                        <a href="#guide-tweaking">Tweaking</a>
                        <ul>
                            <li class="toc-entry toc-h2"><a href="#guide-tweaking-inputs">Programmatically setting inputs</a></li>
                            <li class="toc-entry toc-h2"><a href="#guide-tweaking-api">Using the App API</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</template>

<!-- Root page of an app -->
<template name="BuildErrorPage">
    <div class="page page-full-height bg-white">
        {{#with getApp}}
        <h1 class="page-header">
            <button class="btn btn-lg btn-transparent btn-back link-to-version-page" style="font-size: 24px;">
                <i class="fa fa-arrow-circle-left"></i>
            </button>
            <span>{{name}}</span>

            {{#with getVersion}}
                <i style="font-size: 28px;" class="fa fa-caret-right ml-2 mr-2"></i>
                <span style="font-size: 28px;">{{appVersion}}</span>

                <i style="font-size: 28px;" class="fa fa-caret-right ml-2 mr-2"></i>
                <span style="font-size: 24px;">Build <i>{{buildId}}</i></span>
            {{/with}}

        </h1>
        {{/with}}

        {{#with getVersion}}
        <div class="form-group">
            <label for="build-logs">Build Logs:</label>
            <textarea class="form-control" rows="30" id="build-logs" value="{{buildError}}"></textarea>
        </div>
        {{/with}}
    </div>
</template>


<!-- instanciate a Dualbox app phase -->
<template name="ApplicationPhasePage">
    <div class="container-fluid" style="height: 100vh;">
        <div class="row" style="height: 100%; overflow-y: hidden;">
            <div class="col-xl-10 col-lg-9" style="padding-left: 0; padding-right: 0;">
                <div class="view-app-phase">
                    {{#with getVersion}}
                        {{> ShowVersion appName=appName appVersion=appVersion }}
                    {{/with}}
                </div>
            </div>
            <div class="col-xl-2 col-lg-3 col-md-3 col-sm-3 col-xs-3" style="position: relative; box-shadow: 2px 2px 2px 2px #ccc;">
                <div style="position: absolute; bottom: 0; right: 0; padding-left: 10px;">
                    <span>Powered by </span><a class="navbar-brand d-inline-block" href="{{rooturl}}">
                        <img class="topbar-logo" title="dualbox logo" src="{{rooturl}}/img/logo/logo-dualbox-full.png" height=50 />
                    </a>
                </div>

                {{#with getApp}}
                    <h1 class="mt-1"><b>{{name}}</b></h1>
                    <h2>{{#if title}}{{title}}{{else}}No title defined.{{/if}}</h2>
                    {{#if descriptionImage}}
                        <img style="max-width: 100%;" src="{{descriptionImage}}" />
                    {{else}}
                        <img style="max-width: 100%;" src="/img/ressources/DeployedApps_Big_Icon_success.png" />
                    {{/if}}
                    <p>
                        <i>{{#if description}}{{description}}{{else}}No description available.{{/if}}</i>
                    </p>
                {{/with}}

                <p>Phase: <span class="badge" style="background-color: red; border-radius: 3px!important; padding: 5px;">{{appPhase}}</span></p>
            </div>
        </div>
    </div>
</template>

<template name="AppsBuildingPage">
    <div class="page page-full-height bg-white">
        <h1 class="page-header">
            <button class="btn btn-lg btn-transparent link-to-dashboard" style="font-size: 24px;">
                <i class="fa fa-arrow-circle-left"></i>
            </button>
            <span>All builds</span>
        </h1>

        <p class="form-inline">Show app applications and versions with build status
            <select class="form-control form-inline select-status" style="margin: 10px;">
                <option value="Not deployed">no build yet</option>
                <option value="in queue">in queue</option>
                <option value="building..." selected>building</option>
                <option value="built">deploying</option>
                <option value="deployed">ready</option>
                <option value="error">error</option>
            </select>
        </p>

        <table class="table table-striped apps-building" style="width: 100%;">
            <thead>
                <tr>
                    <th>status</th>
                    <th>Application</th>
                    <th>Version</th>
                    <th>Last update</th>
                    <th>title</th>
                </tr>
            </thead>
            <tbody>
                {{#each getVersions}}
                <tr>
                    <td>{{{getStatusHTML}}}</td>
                    <td><a href="/apps/{{appName}}" title="{{title}}">{{getName}}</a></td>
                    <td><a href="/apps/{{appName}}/v/{{appVersion}}" title="{{title}}">{{appVersion}}</a></td>
                    <td>{{getLastUpdate}}</td>
                    <td>{{title}}</td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</template>
